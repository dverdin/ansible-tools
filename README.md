Ansible-tools
=============

Ansible-tools serves as a starting point and an example of an Ansible playbook with some tools added that
make it easier to use the same playbooks and roles for multiple environments. An environment is a server or set of
servers i.e. your production environment, your staging environment or your local development environment.

Ansible-tools provides:
- Vagrant integration for creating a local development VM
- An automated way to create a new environment, including generating passwords and certificates
- Optional encryption of the passwords and private keys in an environment using a symmetric key (keyczar)

Organisation
------------

Ansible-tools is organised such that the configuration that is specific for an environment can be managed separately
from the Ansible playbook. Environment specific configuration are things like:
- Hostnames, IP addresses
- Firewall rules
- Email addresses
- Passwords, private keys, certificates

The playbooks contain all that remains the same between environments.

Create a development VM
=======================

* Install [Vagrant](https://www.vagrantup.com/) and [VirtualBox](https://www.virtualbox.org). Virtualbox will run 
  the development VMs, Vagrant is used to create, configure and manage the development VM instance.
* Install [Ansible](http://www.ansible.com). There are several ways to install Ansible. They are described in the 
  [installation guide](http://docs.ansible.com/ansible/intro_installation.html).
  
Now create and start the development VMs using `vagrant up`. This prepares a VM that is ready to be managed by Ansible.
It will call a simple Ansible playbook to make some changes to the VM. Run `vagrant provision` to rerun just the 
provisioning step and update the inventory.
  
Ansible environment
===================

The Ansible environment (i.e. the configuration specific to a set of servers like IP addresses and passwords) for the 
development VM is stored in the "environments/vm" directory. The idea is to have an environment directory for each set 
of servers (i.e. testing, staging, production, ...). The vm environment already exists and is setup to work with
the Vagrant VM. It contains:

* A symlink to the inventory file that was generated by Vagrant
* The static IP address for the VM that was configured in Vagrant

The "create_new_environemnt.sh" script is used to create a new environment based on the template stored in
"environments/template". "environment.conf" contains a specification for the passwords and certificate that are
required by the environment.

Create the new environment for the VM: `./scripts/create_new_environment.sh environments/vm`

Ansible Playbook
================

A starting point for a playbook is provided. Run the playbook "site.yml": 
`ansible-playbook site.yml -i environments/vm/inventory`
